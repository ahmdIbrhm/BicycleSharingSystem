<!DOCTYPE html>
<!-- Website template by freewebsitetemplates.com -->
<html>
<head>
	<meta charset="UTF-8">
	<title>Add Cities</title>
	<link rel="stylesheet" href="css/style.css" type="text/css">
</head>
<body>
	<div id="header">
		<div class="wrapper clearfix">
			<div id="logo">
				<a href="index.html"><img src="images/logo.png" width="60" height="50"></a>
			</div>
			<ul id="navigation">
				<li >
                    <a href="index.html">Home</a>
                </li>
				<li class="selected">
                    <a href="blog.html">Add Cities</a>
                </li>
                <li >
                    <a href="map.php">Map</a>
                </li>
                <li>
                    <a href="about.html">Statistics</a>
                </li>
			</ul>
		</div>
	</div>
	<div id="contents">
		<div class="wrapper clearfix">
			<div id="sidebar">
			</div>
		</div>
	</div>
	<div id="footer">
		<div class="wrapper clearfix">


<h1>Add Cities </h1>
				<ul class="list">
					<li>
						Insert Config file (optional):
						<input type="file" id="configFile" onchange="addConfigFile()"></input>
						<h3>Insert a new dataset</h3>
						</p>
						
  						<table id="tableTagsAll" width="75%">
							<tr>
								<td>City name:</td>
								<td><input type="text" id="editTextCityName"/></td>
							</tr>
							<tr>
								<td>Dynamic data link:</td>
								<td><input type="text" id="editTextDynamicDataLink"/></td>
							</tr>
							<tr>
								<td>Link's file type:</td>
								<td>
									<select id="listTypeFileAll">
										<option value="json">JSON</option>
										<option value="csv">CSV</option>
										<option value="xml">XML</option>
									</select>
								</td>
							</tr>
							<tr>
									<td>Path of station id: </td>
									<td><input type="text" id="editTextKeyAll"/></td>
								</tr>
								<tr>
									<td>Path of array of stations:</td>
									<td><input type="text" id="editTextIteratorAll"/></td>
								</tr>
						</table>
						<hr>
						<h3>Static mappings:</h3>
						<table id="tableMappingsStatic" width="75%">
							<!-- <tr>
								<td>Id:</td>
								<td><input type="text" id="editTextIdTag"/></td>
							</tr> -->
							<tr>
								<td>Name:</td>
								<td><input type="text" id="editTextNameTag"/></td>
							</tr>
							<!-- <tr>
								<td>Capacity:</td>
								<td><input type="text" id="editTextCapacityTag"/></td>
							</tr> -->
							<tr>
								<td>Latitude:</td>
								<td><input type="text" id="editTextLatTag"/></td>
							</tr>
							<tr>
								<td>Longtitude:</td>
								<td><input type="text" id="editTextLongTag"/></td>
							</tr>
							</table>
							<table id="tableMapping" width="100%"></table>
						
						<hr>
						<h3>Dynamic Mapping:</h3>
						<table id="tableTagsDynamic" width="88%">
							<tr>
								<td>Available Bicycles:</td>
								<td><input type="text" id="editTextAvailableBicyclesTag"/></td>
							</tr>
							<tr>
								<td>Available Docks:</td>
								<td><input type="text" id="editTextAvailableDocksTag"/></td>
							</tr>
						</table>
						<br>
						<input type="checkbox" id="checkboxStatic" value=off onclick="checkboxChanged()"> Separate file for static data<br>	
					</li>
							<script>
								function addConfigFile()
								{
									// console.log("configggg")
									var file = document.getElementById("configFile").files[0];
									if (file) {
									    var reader = new FileReader();
									    reader.readAsText(file, "UTF-8");
									    reader.onload = function (evt) {
									        // console.log(evt.target.result);
        									var jsonObject=JSON.parse(evt.target.result);
        									var cityName=jsonObject.cityName;
											var dynamicDataLink=jsonObject.dynamicDataLink;
											var fileType=jsonObject.fileType;
											var pathId=jsonObject.pathId;
											var pathStation=jsonObject.pathStation;
											var name=jsonObject.name;
											// var capacity=jsonObject.capacity;
											var lat=jsonObject.lat;
											var long=jsonObject.long;
											var availableBicycles=jsonObject.availableBicycles;
											var availableDocks=jsonObject.availableDocks;

											document.getElementById('editTextCityName').value=cityName;
											document.getElementById('editTextDynamicDataLink').value=dynamicDataLink;
											var listTypeFileAll= document.getElementById('listTypeFileAll');
			  								listTypeFileAll.value=fileType;
			  								document.getElementById('editTextKeyAll').value = pathId;
			  								document.getElementById('editTextIteratorAll').value = pathStation;


			  								document.getElementById('editTextNameTag').value = name;
			  								// document.getElementById('editTextCapacityTag').value = capacity;
			  								document.getElementById('editTextLatTag').value = lat;
			  								document.getElementById('editTextLongTag').value = long;
			  								document.getElementById('editTextAvailableBicyclesTag').value = availableBicycles;
			  								document.getElementById('editTextAvailableDocksTag').value = availableDocks;
									    }
									    reader.onerror = function (evt) {
									        console.log("error reading file");
									    }
									}
								}
								function addMapping() 
								{
									var labelTag='<label>Tag: </label>';
									var editTextTag='<input type="text" name="tag" id="tag">';
									var labelProperty='<label> Property: </label>';
									// var listProperty='<input type="text" name="property" id="property">';
									var listProperty='<select>'+
										'<option value="http://www.wikidata.org/prop/direct/P1083">Capacity</option>'+
										'<option value="http://www.wikidata.org/prop/direct/P6375">Address</option>'+
										'<option value="http://www.wikidata.org/prop/direct/P5017">Last Update</option>'+
										'<option value="https://schema.org/PaymentCard">Bank Card</option>'+
										'</select>';
									// var labelType='<label> Type: </label>';
									// var listType='<select>'+
									// 	'<option value="literal">LITERAL</option><option value="uri">URI</option>'+
									// 	'</select>';
									var buttonDelete='<input type="button" value="Delete" onclick="deleteMapping(this)">'
	  								var array=[labelTag,editTextTag,labelProperty,listProperty,buttonDelete];

	  								var table=document.getElementById("tableMapping");
	  								var row=table.insertRow(-1);
	  								
	  								for(var i=0;i<array.length;i++)
	  								{
	  									var cell=row.insertCell(i);
	  									cell.innerHTML=array[i];
	  								}
								}
								function deleteMapping(element)
								{
									var index=element.parentNode.parentNode.rowIndex;
									document.getElementById("tableMapping").deleteRow(index);
								}

							// addMapping();
						</script>
						<script type="text/javascript">
							var buttonAddMapping="<button onclick='addMapping()'>Add another mapping</button>";
							var row=document.getElementById("tableMappingsStatic").insertRow(-1);
							var cellVirtual=row.insertCell(0);
							var cell=row.insertCell(0);
							cellVirtual.innerHTML="";
							cell.innerHTML=buttonAddMapping;
							// cell.colSpan=2;
						</script>
						<script type="text/javascript">
							function checkboxChanged()
							{
								var tableStaticTags=document.getElementById('tableTagsStatic');
								var checkbox=document.getElementById('checkboxStatic')
								if (checkbox.checked) 
								{
									tableStaticTags.style.visibility = "visible";
							  	} 
							  	else 
							  	{
							      	tableStaticTags.style.visibility = "hidden";
							  	}
							}
						</script>
						<!-- <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script> -->
					    <!-- <script type="text/javascript"> 
							 //    function addStaticData()
							 //    {
							 //        (async () => {

								// 	const { value: file } = await Swal.fire({
								// 	  title: 'Add Static Data',
								// 	  input: 'file',
								// 	  showCancelButton: true,
								// 	  html:

								// 	    // '<input id="swal-input1" class="swal2-input">' ,
								// 	    // '<input id="swal-input2" class="swal2-input">',
								// 	'<select id="listTypeFileStatic"  class="swal2-input" >'+
								// 		'<option value="json">JSON</option>'+
								// 		'<option value="csv">CSV</option>'+
								// 		'<option value="xml">XML</option>'+
								// 	'</select><br>'+
								// 	'<table> <tr> <td><label class="swal2-input"> Station key:</label></td> '+
								// 	'<td><input type="text" id="editTextKeyStatic"/></td></tr>'+

								// 	'<tr><td><label class="swal2-input"> Station Iterator:</label></td> '+
								// 	'<td><input type="text" id="editTextIteratorStatic"/></td></tr>',
								// })

									// if (file) {
										// var listTypeFileStatic = document.getElementById('listTypeFileStatic');
										// var typeOfFileStatic = listTypeFileStatic[listTypeFileStatic.selectedIndex].value;
										// alert(typeOfFileStatic);
										// var keyStatic = document.getElementById('editTextKeyStatic').value;
										// var iteratorStatic = document.getElementById('editTextIteratorStatic').value;


									  // const reader = new FileReader()
									  // reader.onload = (e) => {
									  //   Swal.fire({

									  //     // alert(e.target.result)
									  //     title: 'Ahmd',
									  //     imageUrl: e.target.result,
									  //     imageAlt: 'The uploaded picture'
									  //   })
									  // }
									  // reader.readAsDataURL(file)
									// }

									// })()



									// (async () => {

									// const { value: formValues } = await Swal.fire({
									//   title: 'Multiple inputs',
									//   html:
									//     '<input id="swal-input1" class="swal2-input">' +
									//     '<input id="swal-input2" class="swal2-input">',
									//   focusConfirm: false,
									//   preConfirm: () => {
									//     return [
									//       document.getElementById('swal-input1').value,
									//       document.getElementById('swal-input2').value
									//     ]
									//   }
									// })

									// if (formValues) {
									//   Swal.fire(JSON.stringify(formValues))
									// }

									// })()
					    		} -->
					  </script>
						<table style="visibility:hidden" id="tableTagsStatic" width="100%">
							<tr>
								<td>
									<select id="listTypeFileStatic">
										<option value="json">JSON</option>
										<option value="csv">CSV</option>
										<option value="xml">XML</option>
									</select>
								</td>
								<td><input type="file" id="fileinput"/></td>
							<tr>
								<td>Path of station id:</td>
								<td><input type="text" id="editTextKeyStatic"/></td>
							</tr>
							<tr>
								<td>Path of array of stations:</td>
								<td> <input type="text" id="editTextIteratorStatic"/></td>
							</tr>
							<tr>
    							<td colspan="3"><hr/></td>
  							</tr>
  						</table>
  						<!-- <input type="button" onclick="addStaticData()" value="Add static data"> -->
						<input type="submit" onclick="sendInformation()" value="Send information">
						
						<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

						<script>
							function sendInformation()
							{
								Swal.fire({
								  title: 'Loading Data!',
								  html: 'magic is happening please wait...',
								  // timer: 2000,
								  // timerProgressBar: true,
								  onOpen: () => {
								    Swal.showLoading()
								    sendHttp()
								    // timerInterval = setInterval(() => {
								    //   Swal.getContent().querySelector('b')
								    //     .textContent = Swal.getTimerLeft()
								    // }, 100)
								  },
								  onClose: () => {
								  }
								}).then((result)=> {
									//console.log("result")

								})
							}

							function sendHttp() 
							{
								var listTypeFileStatic = document.getElementById('listTypeFileStatic');
								var typeOfFileStatic = listTypeFileStatic[listTypeFileStatic.selectedIndex].value;
								var fileStatic = document.getElementById('fileinput').files[0];
								var keyStatic = document.getElementById('editTextKeyStatic').value;
								var iteratorStatic = document.getElementById('editTextIteratorStatic').value;

								// Table to add mappings on runtime
								var tableMapping = document.getElementById('tableMapping');
								var nbOfRows = tableMapping.rows.length;

								//table that contains the static mappings: id, name, capacity, lat, long
								var tableMappingsStatic=document.getElementById('tableMappingsStatic');
								// var tagId=tableMappingsStatic.rows[0].cells[1].childNodes[0].value;
								var tagName=tableMappingsStatic.rows[0].cells[1].childNodes[0].value;
								// var tagCapacity=tableMappingsStatic.rows[1].cells[1].childNodes[0].value;
								var tagLatitude=tableMappingsStatic.rows[1].cells[1].childNodes[0].value;
								var tagLongtitude=tableMappingsStatic.rows[2].cells[1].childNodes[0].value;

								var cityName = document.getElementById('editTextCityName').value;
								var dynamicLinkAll=document.getElementById('editTextDynamicDataLink').value;
								var listTypeFileAll = document.getElementById('listTypeFileAll');
  								var typeOfFileAll=listTypeFileAll[listTypeFileAll.selectedIndex].value;
  								var dynamicKeyAll=document.getElementById('editTextKeyAll').value;
  								var dynamicIteratorAll=document.getElementById('editTextIteratorAll').value;
				  				
	
								//define the properties used byour system							
								var propertyName="http://www.w3.org/2000/01/rdf-schema#label";
								// var propertyCapacity="http://www.wikidata.org/prop/direct/P1083";
								var propertyLatitude="http://www.w3.org/2003/01/geo/wgs84_pos#lat";
								var propertyLongtitude="http://www.w3.org/2003/01/geo/wgs84_pos#long";
								var propertyAvailableBicycles="http://smart-ics.ee.surrey.ac.uk/ontology/m3-lite.owl#CountAvailableBicycles";
								var propertyAvailableDocks="http://purl.org/iot/vocab/m3-lite#CountEmptyDockingPoints";

								// var arrayTagsStatic=[tagName,tagCapacity,tagLatitude,tagLongtitude];
								// var arrayProperties=[propertyName,propertyCapacity,propertyLatitude,propertyLongtitude];

								var arrayTagsStatic=[tagName,tagLatitude,tagLongtitude];
								var arrayProperties=[propertyName,propertyLatitude,propertyLongtitude];



								var arrayMappings=[];
								var typesStaticMappings=["literal","decimal","decimal"];
								for(var i=0;i<arrayTagsStatic.length;i++)
								{
									var mapping={"tag":"\\\."+arrayTagsStatic[i]+"\\z","property":arrayProperties[i],"type":typesStaticMappings[i]};
									arrayMappings.push(mapping);
								}

								var typesofAddedMappings=["integer","literal","literal","boolean"];
							    for ( var i = 0; row = tableMapping.rows[i]; i++ ) 
							    {
							      	row = tableMapping.rows[i];
							      	var tag=row.cells[1].childNodes[0].value;
							      	var property=row.cells[3].childNodes[0].value;
							      	var type=typesofAddedMappings[row.cells[3].childNodes[0].selectedIndex];
							      	console.log(type);
							      	var mapping={"tag":"\\\."+tag+"\\z","property":property,"type":type};
							      	arrayMappings.push(mapping);
							 	}

							 	// alert(arrayMappings.length);

							 	var availableBicycles=document.getElementById('editTextAvailableBicyclesTag').value;
  								var availableDocks=document.getElementById('editTextAvailableDocksTag').value;
  								var mappingAvailableBicycles={"tag":"\\\."+availableBicycles+"\\z","property":propertyAvailableBicycles,"type":"literal"};
  								// Type is literal for java tool purpose!!
  								var mappingAvailableDocks={"tag":"\\\."+availableDocks+"\\z","property":propertyAvailableDocks,"type":"literal"};
  								var arrayMappingsDynamic=[];

  								var request = new XMLHttpRequest();
  								request.open("POST", "script.php");

  								var formData = new FormData();

								var only1File=false;
								
								var checkbox=document.getElementById('checkboxStatic')
								if (checkbox.checked) 
								{
							    	only1File=false;
							  	} 
							  	else 
							  	{
							  		only1File=true;
							  	}
  								//when there is only 1 file
							 	if(only1File==true)
  								{
  									arrayMappings.push(mappingAvailableBicycles);
  									arrayMappings.push(mappingAvailableDocks);

  									var allParameters={"linkFile":dynamicLinkAll, "cityName":cityName,"typeOfFile":typeOfFileAll,"key":dynamicKeyAll,"iterator":dynamicIteratorAll,"arrayMappings":arrayMappings};
  									var allOptions = JSON.stringify(allParameters);
  									formData.append("allOptions",allOptions);
  								}
  								else //more than 1 file
  								{
  									arrayMappingsDynamic.push(mappingAvailableBicycles);
  									arrayMappingsDynamic.push(mappingAvailableDocks);

  									var allParameters={"cityName":cityName,"typeOfFile":typeOfFileStatic,"key":keyStatic,"iterator":iteratorStatic,"arrayMappings":arrayMappings};

  									var dynamicParameters={"linkFile":dynamicLinkAll,"typeOfFile":typeOfFileAll,"key":dynamicKeyAll,"iterator":dynamicIteratorAll,"arrayMappings":arrayMappingsDynamic};

  									var staticOptions = JSON.stringify(allParameters);
  									var dynamicOptions=JSON.stringify(dynamicParameters);
  									formData.append("file", fileStatic);
									formData.append("staticOptions",staticOptions);
									formData.append("dynamicOptions",dynamicOptions);
  								}

  								request.send(formData);
								
  								request.onreadystatechange = function() {
							        // Check if the request is compete and was successful
							        // alert("Asd");
							        // alert("Ready state: "+this.readyState);
							        // alert("Status: "+this.status);
							        if(this.readyState === 4 && this.status === 200) {

							        	// add conditions on this.responseText if
							        	// loading was successful or not (depends on the return of the function) 
							        	Swal.close()
							        	Swal.fire(
											  'Finished !',
											  this.responseText
										)
							    	}
						    	};
							}
						</script>						
					<li>
						<br>
					</li>
				</ul>
			</div>
		<div class="body">
			<div class="wrapper clearfix">
				<div id="links">
					<div>
						<h4>Social</h4>
						<ul>
							<li>
								<a href="http://freewebsitetemplates.com/go/googleplus/" target="_blank">Google +</a>
							</li>
							<li>
								<a href="http://freewebsitetemplates.com/go/facebook/" target="_blank">Facebook</a>
							</li>
							<li>
								<a href="http://freewebsitetemplates.com/go/youtube/" target="_blank">Youtube</a>
							</li>
						</ul>
					</div>
					<div>
						<h4>Heading placeholder</h4>
						<ul>
							<li>
								<a href="index.html">Link Title 1</a>
							</li>
							<li>
								<a href="index.html">Link Title 2</a>
							</li>
							<li>
								<a href="index.html">Link Title 3</a>
							</li>
						</ul>
					</div>
				</div>
				<div id="newsletter">
					<h4>Newsletter</h4>
					<p>
						Sign up for Our Newsletter
					</p>
					<form action="index.html" method="post">
						<input type="text" value="">
						<input type="submit" value="Sign Up!">
					</form>
				</div>
				<p class="footnote">
					© Copyright © 2023.Company name all rights reserved
				</p>
			</div>
		</div>
	</div>
</body>
</html>

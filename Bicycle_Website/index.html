<!DOCTYPE html>
<!-- Website template by freewebsitetemplates.com -->
<html>
<head>
	<style type="text/css">
      html, body, #basicMap {
          height: 600px;  /* The height is 400 pixels */
        width: 100%;
      }
    </style>
    <script src="OpenLayersDir/OpenLayers.js"></script>
    <script >
    	function init() {
    		map = new OpenLayers.Map("basicMap");
    		var mapnik         = new OpenLayers.Layer.OSM();
        var fromProjection = new OpenLayers.Projection("EPSG:4326");   // Transform from WGS 1984
        var toProjection   = new OpenLayers.Projection("EPSG:900913"); // to Spherical Mercator Projection
        var position       = new OpenLayers.LonLat(4.3872,45.4397).transform( fromProjection, toProjection);
        var zoom           = 14; 

        var lat = 45.442972;
        var lon = 4.398855;

        var marker_position       = new OpenLayers.LonLat(lon, lat).transform( fromProjection, toProjection);

        map.addLayer(mapnik);
        
        //var markers = new OpenLayers.Layer.Markers( "Markers" );
		var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
        //map.addLayer(markers);
        //markers.addMarker(new OpenLayers.Marker(marker_position));
        loadMarkers(vectorLayer,fromProjection, toProjection);
        
        map.addLayer(vectorLayer);
        var controls = { selector: new OpenLayers.Control.SelectFeature(vectorLayer, { onSelect: createPopup, onUnselect: destroyPopup }) };
        map.addControl(controls['selector']);
    	controls['selector'].activate();
        
        map.setCenter(position, zoom );
        
    }
    function loadMarkers(vectorLayer,fromProjection,toProjection) {
    	var xhttp = new XMLHttpRequest();
    	xhttp.onreadystatechange = function() {
    		if (this.readyState == 4 && this.status == 200) {
    			var obj = JSON.parse(this.responseText);
    			var results = obj.results;
    			var bindings = results.bindings;
    			var str = '';
    			for (var i = 0; i < bindings.length; i++) {
    				var obj = bindings[i];
    				var lat_obj = obj['lat'];
    				var lon_obj = obj['lon'];

    				var lat_value = lat_obj.value;
    				var lon_value = lon_obj.value;
    				var capacity = obj['capacity'].value;
    				var name = obj['name'].value;

    				//add markers on map
    				var feature = new OpenLayers.Feature.Vector(
    					new OpenLayers.Geometry.Point(lon_value, lat_value).transform(fromProjection, toProjection),
    					{description:'<b>Bicycle station</b> <br/> name: '+name+'<br/>capacity: '+capacity} ,
    					{externalGraphic: 'OpenLayersDir/img/marker.png', graphicHeight: 30, graphicWidth: 27, graphicXOffset:-12, graphicYOffset:-25  }
    					);    
    				vectorLayer.addFeatures(feature);

    			}
    		}
    	};
    	xhttp.open("POST", "http://localhost:3030/bicyledata/query", true);
    	xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    	xhttp.send("query=select ?lat ?lon ?capacity ?name where {?station <http://www.w3.org/2003/01/geo/wgs84_pos#long> ?lon ; <http://www.w3.org/2003/01/geo/wgs84_pos#lat> ?lat ;<http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.w3.org/2003/01/geo/wgs84_pos#SpatialThing> ;<http://www.w3.org/2000/01/rdf-schema#label> ?name; <http://www.wikidata.org/prop/direct/P1083> ?capacity }");
    }
    function createPopup(feature) {
      feature.popup = new OpenLayers.Popup.FramedCloud("pop",
          feature.geometry.getBounds().getCenterLonLat(),
          null,
          '<div class="markerContent">'+feature.attributes.description+'</div>',
          null,
          true,
          function() { controls['selector'].unselectAll(); }
      );
      //feature.popup.closeOnMove = true;
      map.addPopup(feature.popup);
    }

    function destroyPopup(feature) {
      feature.popup.destroy();
      feature.popup = null;
    }
    
    </script>

	<meta charset="UTF-8">
	<title>Astronomy Website Template</title>
	<link rel="stylesheet" href="css/style.css" type="text/css">
	<link rel="stylesheet" href="css/combo.css" type="text/css">
	
</head>
<body onload="init()">
	<div id="header">
		<div class="wrapper clearfix">
			<div id="logo">
			</div>
			<ul id="navigation">
				<li class="selected">
					<a href="index.html">Map</a>
				</li>
				<li>
					<a href="about.html">About</a>
				</li>
				<li>
					<a href="blog.html">Blog</a>
				</li>
				<li>
					<a href="gallery.html">Gallery</a>
				</li>
				<li>
					<a href="contact.html">Contact Us</a>
				</li>
			</ul>
		</div>
	</div>
	<div id="footer">
		<div class="body">
			<div class="wrapper clearfix">
				<div id="links">
					<div>		
						<h3 style="color:white;">Choose city:</h3>
					</div>
					<div class="custom-select" style="width:300px;">
							<select>
  								<option value="Saint-Etienne">Saint-Etienne</option>
  								<option value="Lyon">Lyon</option>
  								<option value="Montpellier">Montpellier</option>
  								<option value="Paris">Paris</option>
							</select>
					</div>
				</div>
				<div>
					<br/>
					<br/>
					<h3 style="color:white;"> Check bicycle stations with the description of the current state by clicking on the marker </h3>
				</div>
			</div>
		</div>
	</div>
	<div id="contents">
		<div id="basicMap">
			
		</div>

	</div>
	
	<script>
var x, i, j, selElmnt, a, b, c;
/*look for any elements with the class "custom-select":*/
x = document.getElementsByClassName("custom-select");
for (i = 0; i < x.length; i++) {
  selElmnt = x[i].getElementsByTagName("select")[0];
  /*for each element, create a new DIV that will act as the selected item:*/
  a = document.createElement("DIV");
  a.setAttribute("class", "select-selected");
  a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
  x[i].appendChild(a);
  /*for each element, create a new DIV that will contain the option list:*/
  b = document.createElement("DIV");
  b.setAttribute("class", "select-items select-hide");
  for (j = 1; j < selElmnt.length; j++) {
    /*for each option in the original select element,
    create a new DIV that will act as an option item:*/
    c = document.createElement("DIV");
    c.innerHTML = selElmnt.options[j].innerHTML;
    c.addEventListener("click", function(e) {
        /*when an item is clicked, update the original select box,
        and the selected item:*/
        var y, i, k, s, h;
        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
        h = this.parentNode.previousSibling;
        for (i = 0; i < s.length; i++) {
          if (s.options[i].innerHTML == this.innerHTML) {
            s.selectedIndex = i;
            h.innerHTML = this.innerHTML;
            y = this.parentNode.getElementsByClassName("same-as-selected");
            for (k = 0; k < y.length; k++) {
              y[k].removeAttribute("class");
            }
            this.setAttribute("class", "same-as-selected");
            break;
          }
        }
        h.click();
    });
    b.appendChild(c);
  }
  x[i].appendChild(b);
  a.addEventListener("click", function(e) {
      /*when the select box is clicked, close any other select boxes,
      and open/close the current select box:*/
      e.stopPropagation();
      closeAllSelect(this);
      this.nextSibling.classList.toggle("select-hide");
      this.classList.toggle("select-arrow-active");
    });
}
function closeAllSelect(elmnt) {
  /*a function that will close all select boxes in the document,
  except the current select box:*/
  var x, y, i, arrNo = [];
  x = document.getElementsByClassName("select-items");
  y = document.getElementsByClassName("select-selected");
  for (i = 0; i < y.length; i++) {
    if (elmnt == y[i]) {
      arrNo.push(i)
    } else {
      y[i].classList.remove("select-arrow-active");
    }
  }
  for (i = 0; i < x.length; i++) {
    if (arrNo.indexOf(i)) {
      x[i].classList.add("select-hide");
    }
  }
}
/*if the user clicks anywhere outside the select box,
then close all select boxes:*/
document.addEventListener("click", closeAllSelect);
</script>
</body>
</html>